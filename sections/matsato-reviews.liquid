{{ 'component-slider.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top_mobile }}px;
    padding-bottom: {{ section.settings.padding_bottom_mobile }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top_desktop }}px;
      padding-bottom: {{ section.settings.padding_bottom_desktop }}px;
    }
  }

  .matsato-reviews-v2 .grid {
    column-gap: 10px;
    row-gap: 0;
  }

  .matsato-review-v2-card {
    background-color: {{ section.settings.card_bg_color }};
    border: 1px solid rgba(var(--color-foreground), 0.1);
    border-radius: 12px;
    padding: 14px;
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    height: 100%;
    position: relative;
    overflow: hidden;
  }

  .matsato-reviews-v2 .slider-component-desktop {
    max-width: var(--page-width);
    margin: 0 auto;
  }

  .matsato-reviews-v2 .slider--desktop {
    scroll-padding-left: 0;
  }

  .matsato-reviews-v2 .slider--desktop .slider__slide:first-child {
    margin-left: 0;
    scroll-margin-left: 0;
  }

  /* Adjust grid item widths for the slider when margins are reset */
  @media screen and (min-width: 990px) {
    .matsato-reviews-v2 .slider--desktop .grid__item {
      width: calc((100% - var(--grid-desktop-horizontal-spacing) * ({{ section.settings.columns_desktop }} - 1)) / {{ section.settings.columns_desktop }});
    }
  }

  .matsato-review-v2-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
    border-color: rgba(var(--color-foreground), 0.2);
  }

  .matsato-review-v2-card__header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 20px;
  }

  .matsato-review-v2-card__profile-image {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    overflow: hidden;
    flex-shrink: 0;
    border: 2px solid rgba(var(--color-foreground), 0.05);
  }
  
  .matsato-review-v2-card__profile-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .matsato-review-v2-card__details {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .matsato-review-v2-card__name {
    font-size: 1.6rem;
    font-weight: 700;
    margin: 0;
    color: rgb(var(--color-foreground));
    line-height: 1.2;
  }

  .matsato-review-v2-card__verified {
    display: flex;
    align-items: center;
    gap: 4px;
    color: #008a00;
    font-size: 1.2rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .matsato-review-v2-card__verified svg {
    width: 14px;
    height: 14px;
    fill: currentColor;
  }

  .matsato-review-v2-card__stars {
    display: flex;
    gap: 2px;
    margin-bottom: 16px;
    color: #ffb800;
  }

  .matsato-review-v2-card__stars svg {
    width: 16px;
    height: 16px;
  }

  .matsato-review-v2-card__text {
    font-size: 1.5rem;
    line-height: 1.7;
    margin-top: 18px;
    color: rgba(var(--color-foreground), 0.8);
    font-style: italic;
  }

  .matsato-review-v2-card__text p {
    margin: 0;
  }

  .matsato-review-v2-card__image {
    width: 100%;
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid rgba(var(--color-foreground), 0.05);
  }

  .matsato-review-v2-card__image img {
    width: 100%;
    height: auto;
    display: block;
    object-fit: cover;
    aspect-ratio: 4/3;
    transition: transform 0.5s ease;
  }

  .matsato-review-v2-card:hover .matsato-review-v2-card__image img {
    transform: scale(1.05);
  }

  .matsato-reviews-v2__title {
    margin-bottom: 56px;
    font-weight: 800;
    letter-spacing: -0.02em;
  }

  .matsato-reviews-v2 .slider-buttons {
    margin-top: 32px;
  }
{%- endstyle -%}

{%- liquid
  assign columns_mobile_int = section.settings.columns_mobile | plus: 0
  assign show_mobile_slider = false
  if section.settings.swipe_on_mobile and section.blocks.size > columns_mobile_int
    assign show_mobile_slider = true
  endif

  assign show_desktop_slider = false
  if section.settings.enable_desktop_slider and section.blocks.size > section.settings.columns_desktop
    assign show_desktop_slider = true
  endif
-%}

<section class="matsato-reviews-v2 color-{{ section.settings.color_scheme }} gradient section-{{ section.id }}-padding">
  <div class="page-width">
    {%- if section.settings.heading != blank -%}
      <h2 class="matsato-reviews-v2__title center h1">
        {{ section.settings.heading }}
      </h2>
    {%- endif -%}

    <slider-component class="slider-mobile-gutter {% if show_mobile_slider %} slider-component-tablet-down{% endif %}{% if show_desktop_slider %} slider-component-desktop{% endif %}">
      <ul
        id="Slider-{{ section.id }}"
        class="grid product-grid contains-card grid--{{ section.settings.columns_desktop }}-col-desktop grid--{{ section.settings.columns_mobile }}-col-tablet-down{% if show_mobile_slider or show_desktop_slider %} slider{% if show_desktop_slider %} slider--desktop{% endif %}{% if show_mobile_slider %} slider--tablet{% endif %}{% endif %}"
        role="list"
      >
        {%- for block in section.blocks -%}
          <li
            id="Slide-{{ section.id }}-{{ forloop.index }}"
            class="grid__item{% if show_mobile_slider or show_desktop_slider %} slider__slide{% endif %}"
            {{ block.shopify_attributes }}
          >
            <div class="matsato-review-v2-card">
              <div class="matsato-review-v2-card__header">
                {%- if block.settings.customer_profile_image != blank -%}
                  <div class="matsato-review-v2-card__profile-image">
                    {{ block.settings.customer_profile_image | image_url: width: 120 | image_tag: loading: 'lazy' }}
                  </div>
                {%- endif -%}
                <div class="matsato-review-v2-card__details">
                  {%- if block.settings.customer_name != blank -%}
                    <h3 class="matsato-review-v2-card__name">{{ block.settings.customer_name }}</h3>
                  {%- endif -%}

                  {%- if block.settings.show_verified -%}
                    <div class="matsato-review-v2-card__verified">
                      <svg viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                      </svg>
                      <span>Verified Buyer</span>
                    </div>
                  {%- endif -%}
                </div>
              </div>

              <div class="matsato-review-v2-card__stars">
                {%- for i in (1..5) -%}
                  <svg
                    viewBox="0 0 24 24"
                    fill="{% if i <= block.settings.rating %}currentColor{% else %}rgba(var(--color-foreground), 0.1){% endif %}"
                  >
                    <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2l-2.81 6.63L2 9.24l5.46 4.73L5.82 21z"/>
                  </svg>
                {%- endfor -%}
              </div>
              {%- if block.settings.review_image != blank -%}
                <div class="matsato-review-v2-card__image">
                  {{ block.settings.review_image | image_url: width: 600 | image_tag: loading: 'lazy' }}
                </div>
              {%- endif -%}

              {%- if block.settings.description != blank -%}
                <div class="matsato-review-v2-card__text rte">
                  {{ block.settings.description }}
                </div>
              {%- endif -%}

            </div>
          </li>
        {%- endfor -%}
      </ul>

      {%- if show_mobile_slider or show_desktop_slider -%}
        <div class="slider-buttons no-js-hidden">
          <button
            type="button"
            class="slider-button slider-button--prev"
            name="previous"
            aria-label="{{ 'general.slider.previous_slide' | t }}"
          >
            <span class="svg-wrapper">
              {{- 'icon-caret.svg' | inline_asset_content -}}
            </span>
          </button>
          <div class="slider-counter caption">
            <span class="slider-counter--current">1</span>
            <span aria-hidden="true"> / </span>
            <span class="visually-hidden">{{ 'general.slider.of' | t }}</span>
            <span class="slider-counter--total">{{ section.blocks.size }}</span>
          </div>
          <button
            type="button"
            class="slider-button slider-button--next"
            name="next"
            aria-label="{{ 'general.slider.next_slide' | t }}"
          >
            <span class="svg-wrapper">
              {{- 'icon-caret.svg' | inline_asset_content -}}
            </span>
          </button>
        </div>
      {%- endif -%}
    </slider-component>
  </div>
</section>

{% schema %}
{
  "name": "Matsato Reviews V2",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "inline_richtext",
      "id": "heading",
      "default": "CUSTOMER REVIEWS",
      "label": "Heading"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-4"
    },
    {
      "type": "color",
      "id": "card_bg_color",
      "label": "Review Block Background Color",
      "default": "transparent"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 3,
      "label": "Number of columns on desktop"
    },
    {
      "type": "checkbox",
      "id": "enable_desktop_slider",
      "label": "Enable slider on desktop",
      "default": true
    },
    {
      "type": "header",
      "content": "Mobile Layout"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "default": "1",
      "label": "Number of columns on mobile",
      "options": [
        {
          "value": "1",
          "label": "1 column"
        },
        {
          "value": "2",
          "label": "2 columns"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "swipe_on_mobile",
      "default": true,
      "label": "Enable swipe on mobile"
    },
    {
      "type": "header",
      "content": "Section Padding"
    },
    {
      "type": "range",
      "id": "padding_top_desktop",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Padding Top (Desktop)",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom_desktop",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom (Desktop)",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Top (Mobile)",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom (Mobile)",
      "default": 40
    }
  ],
  "blocks": [
    {
      "type": "review",
      "name": "Review",
      "settings": [
        {
          "type": "text",
          "id": "customer_name",
          "label": "Customer Name",
          "default": "Isaac Tramyer Seyer"
        },
        {
          "type": "image_picker",
          "id": "customer_profile_image",
          "label": "Customer Profile Image"
        },
        {
          "type": "checkbox",
          "id": "show_verified",
          "label": "Show Verified Customer Tag",
          "default": true
        },
        {
          "type": "range",
          "id": "rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "label": "Rating",
          "default": 5
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description",
          "default": "<p>Their knives are high quality and really good for chopping. The knife is very sharp and the price is acceptable. Their delivery time was good also. Definitely recommend them.</p>"
        },
        {
          "type": "image_picker",
          "id": "review_image",
          "label": "Review Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Customer Reviews V2",
      "blocks": [
        { "type": "review" },
        { "type": "review" },
        { "type": "review" }
      ]
    }
  ]
}
{% endschema %}
